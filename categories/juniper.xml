<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0"><channel><title>Weird random notes (juniper)</title><link>https://andir.github.io/</link><description></description><atom:link rel="self" href="https://andir.github.io/categories/juniper.xml" type="application/rss+xml"></atom:link><language>en</language><lastBuildDate>Tue, 08 Nov 2016 16:09:43 GMT</lastBuildDate><generator>https://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Juniper MCD decided to coredump on commit and rollback</title><link>https://andir.github.io/posts/juniper-config-recovery-mcd-coredump/</link><dc:creator>Andreas Rammhold</dc:creator><description>&lt;div&gt;&lt;p&gt;On a Juniper EX3300 a colleague of mine entered an invalid statement:&lt;/p&gt;
&lt;pre class="code shell"&gt;&lt;a name="rest_code_75cef76e518e48939debe00ae0759f89-1"&gt;&lt;/a&gt;interface-range some_ports &lt;span class="o"&gt;{&lt;/span&gt;
&lt;a name="rest_code_75cef76e518e48939debe00ae0759f89-2"&gt;&lt;/a&gt;    member ge0/0/2&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_75cef76e518e48939debe00ae0759f89-3"&gt;&lt;/a&gt;    member-range ge-0/0/0 to ge-0/0/1&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_75cef76e518e48939debe00ae0759f89-4"&gt;&lt;/a&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;The &lt;cite&gt;member ge0/0/2&lt;/cite&gt; is missing a &lt;cite&gt;-&lt;/cite&gt; between &lt;cite&gt;ge&lt;/cite&gt; and &lt;cite&gt;0/0/2&lt;/cite&gt;. Juniper (for whatever reason) accepted the input but &lt;cite&gt;mcd&lt;/cite&gt; decided to segfault when asked to delete or rollback the configuration.&lt;/p&gt;
&lt;pre class="code shell"&gt;&lt;a name="rest_code_d03ae3ed8d6943a49cd84b5550351c6e-1"&gt;&lt;/a&gt;pid &lt;span class="m"&gt;75982&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;mgd&lt;span class="o"&gt;)&lt;/span&gt;, uid 0: exited on signal &lt;span class="m"&gt;11&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;core dumped&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;Recovering from that case is actually not that hard. You just have to know the right command ;-)&lt;/p&gt;
&lt;p&gt;You can load an older configuration via the &lt;cite&gt;load override &amp;lt;config file&amp;gt;&lt;/cite&gt; command. I did also try the &lt;cite&gt;load replace &amp;lt;config file&amp;gt;&lt;/cite&gt; command but that also segfaulted..&lt;/p&gt;
&lt;pre class="code shell"&gt;&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-1"&gt;&lt;/a&gt;andi@foo# load override ?
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-2"&gt;&lt;/a&gt;Possible completions:
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-3"&gt;&lt;/a&gt;  &amp;lt;filename&amp;gt;           Filename &lt;span class="o"&gt;(&lt;/span&gt;URL, local, remote, or floppy&lt;span class="o"&gt;)&lt;/span&gt;
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-4"&gt;&lt;/a&gt;  db/                  Last changed: Oct &lt;span class="m"&gt;27&lt;/span&gt; 10:44:35
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-5"&gt;&lt;/a&gt;  juniper.conf+.gz     Size: 6000, Last changed: Nov &lt;span class="m"&gt;08&lt;/span&gt; 15:12:55
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-6"&gt;&lt;/a&gt;  juniper.conf.1.gz    Size: 5913, Last changed: Jun &lt;span class="m"&gt;30&lt;/span&gt; 13:36:52
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-7"&gt;&lt;/a&gt;  juniper.conf.2.gz    Size: 5881, Last changed: Jun &lt;span class="m"&gt;30&lt;/span&gt; 12:59:25
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-8"&gt;&lt;/a&gt;  juniper.conf.3.gz    Size: 5280, Last changed: Jun &lt;span class="m"&gt;30&lt;/span&gt; 12:54:02
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-9"&gt;&lt;/a&gt;  &lt;span class="o"&gt;[&lt;/span&gt;...&lt;span class="o"&gt;]&lt;/span&gt;
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-10"&gt;&lt;/a&gt;&lt;span class="o"&gt;{&lt;/span&gt;master:0&lt;span class="o"&gt;}[&lt;/span&gt;edit&lt;span class="o"&gt;]&lt;/span&gt;
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-11"&gt;&lt;/a&gt;andi@foo# load override juniper.conf+.gz
&lt;a name="rest_code_354bd1a85d96433884283b4d35a1b1cb-12"&gt;&lt;/a&gt;load &lt;span class="nb"&gt;complete&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;In my case the &lt;cite&gt;juniper.conf+.gz&lt;/cite&gt; was the desired config file. I recommend inspecting those files before loading them (they are stored in &lt;cite&gt;/config/&lt;/cite&gt;).&lt;/p&gt;&lt;/div&gt;</description><category>config</category><category>juniper</category><category>recovery</category><guid>https://andir.github.io/posts/juniper-config-recovery-mcd-coredump/</guid><pubDate>Tue, 08 Nov 2016 15:00:00 GMT</pubDate></item></channel></rss>