<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Weird random notes (Posts about recovery)</title><link>https://andir.github.io/</link><description></description><atom:link href="https://andir.github.io/categories/recovery.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><lastBuildDate>Sat, 22 Apr 2017 16:51:29 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Juniper MCD decided to coredump on commit and rollback</title><link>https://andir.github.io/posts/juniper-config-recovery-mcd-coredump/</link><dc:creator>Andreas Rammhold</dc:creator><description>&lt;div&gt;&lt;p&gt;On a Juniper EX3300 a colleague of mine entered an invalid statement:&lt;/p&gt;
&lt;pre class="code shell"&gt;&lt;a name="rest_code_49235dfa72f94f99becb67cfb5ff764a-1"&gt;&lt;/a&gt;interface-range some_ports &lt;span class="o"&gt;{&lt;/span&gt;
&lt;a name="rest_code_49235dfa72f94f99becb67cfb5ff764a-2"&gt;&lt;/a&gt;    member ge0/0/2&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_49235dfa72f94f99becb67cfb5ff764a-3"&gt;&lt;/a&gt;    member-range ge-0/0/0 to ge-0/0/1&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a name="rest_code_49235dfa72f94f99becb67cfb5ff764a-4"&gt;&lt;/a&gt;&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;The &lt;cite&gt;member ge0/0/2&lt;/cite&gt; is missing a &lt;cite&gt;-&lt;/cite&gt; between &lt;cite&gt;ge&lt;/cite&gt; and &lt;cite&gt;0/0/2&lt;/cite&gt;. Juniper (for whatever reason) accepted the input but &lt;cite&gt;mcd&lt;/cite&gt; decided to segfault when asked to delete or rollback the configuration.&lt;/p&gt;
&lt;pre class="code shell"&gt;&lt;a name="rest_code_2983cccfae69446a9a771b327a0c6f6e-1"&gt;&lt;/a&gt;pid &lt;span class="m"&gt;75982&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;mgd&lt;span class="o"&gt;)&lt;/span&gt;, uid &lt;span class="m"&gt;0&lt;/span&gt;: exited on signal &lt;span class="m"&gt;11&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;core dumped&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;Recovering from that case is actually not that hard. You just know the right command(s) ;-)&lt;/p&gt;
&lt;p&gt;You can load an older configuration via the &lt;cite&gt;load override &amp;lt;config file&amp;gt;&lt;/cite&gt; command. I did also try the &lt;cite&gt;load replace &amp;lt;config file&amp;gt;&lt;/cite&gt; command but that also segfaulted..&lt;/p&gt;
&lt;pre class="code shell"&gt;&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-1"&gt;&lt;/a&gt;andi@foo# load override ?
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-2"&gt;&lt;/a&gt;Possible completions:
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-3"&gt;&lt;/a&gt;  &amp;lt;filename&amp;gt;           Filename &lt;span class="o"&gt;(&lt;/span&gt;URL, local, remote, or floppy&lt;span class="o"&gt;)&lt;/span&gt;
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-4"&gt;&lt;/a&gt;  db/                  Last changed: Oct &lt;span class="m"&gt;27&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:44:35
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-5"&gt;&lt;/a&gt;  juniper.conf+.gz     Size: &lt;span class="m"&gt;6000&lt;/span&gt;, Last changed: Nov &lt;span class="m"&gt;08&lt;/span&gt; &lt;span class="m"&gt;15&lt;/span&gt;:12:55
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-6"&gt;&lt;/a&gt;  juniper.conf.1.gz    Size: &lt;span class="m"&gt;5913&lt;/span&gt;, Last changed: Jun &lt;span class="m"&gt;30&lt;/span&gt; &lt;span class="m"&gt;13&lt;/span&gt;:36:52
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-7"&gt;&lt;/a&gt;  juniper.conf.2.gz    Size: &lt;span class="m"&gt;5881&lt;/span&gt;, Last changed: Jun &lt;span class="m"&gt;30&lt;/span&gt; &lt;span class="m"&gt;12&lt;/span&gt;:59:25
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-8"&gt;&lt;/a&gt;  juniper.conf.3.gz    Size: &lt;span class="m"&gt;5280&lt;/span&gt;, Last changed: Jun &lt;span class="m"&gt;30&lt;/span&gt; &lt;span class="m"&gt;12&lt;/span&gt;:54:02
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-9"&gt;&lt;/a&gt;  &lt;span class="o"&gt;[&lt;/span&gt;...&lt;span class="o"&gt;]&lt;/span&gt;
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-10"&gt;&lt;/a&gt;&lt;span class="o"&gt;{&lt;/span&gt;master:0&lt;span class="o"&gt;}[&lt;/span&gt;edit&lt;span class="o"&gt;]&lt;/span&gt;
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-11"&gt;&lt;/a&gt;andi@foo# load override juniper.conf+.gz
&lt;a name="rest_code_fe93c0aada6146dcaf2fe7143f0d1ede-12"&gt;&lt;/a&gt;load &lt;span class="nb"&gt;complete&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;In my case the &lt;cite&gt;juniper.conf+.gz&lt;/cite&gt; was the desired config file. I recommend inspecting those files before loading them (they are stored in &lt;cite&gt;/config/&lt;/cite&gt;).&lt;/p&gt;&lt;/div&gt;</description><category>config</category><category>juniper</category><category>recovery</category><guid>https://andir.github.io/posts/juniper-config-recovery-mcd-coredump/</guid><pubDate>Tue, 08 Nov 2016 15:00:00 GMT</pubDate></item></channel></rss>